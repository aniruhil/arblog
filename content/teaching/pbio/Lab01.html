---
title: "Lab 1"
author: "Ani Ruhil"
date: "January 15, 2016"
output:
  html_document:
    toc: yes
  fontsize: 10
  word_document:
    highlight: tango
    toc: yes
---



<div id="installing-and-loading-packages" class="section level1">
<h1>Installing and Loading packages</h1>
<p>You can either use the “Tools” menu to select “Install Packages…” and enter the package name(s) or run a command as shown below:</p>
<pre class="r"><code>packs = c(&quot;epitools&quot;, &quot;psych&quot;, &quot;lattice&quot;, &quot;binom&quot;, &quot;car&quot;, &quot;multcomp&quot;, &quot;ggplot2&quot;, &quot;ggmap&quot;, &quot;plotly&quot;)
# install.packages(packs, dependencies = TRUE, repos=&quot;https://cran.rstudio.com&quot;)</code></pre>
<p>Note: “repos=”&quot; is short for the URL of the repository from which packages should be downloaded. “dependencies = TRUE” tells R to also download any other packages that are linked to the package you want to install.</p>
<p>If any of these packages is updated by its author I will let you know how to update them.</p>
<p>Once a package has been installed, we can disable the R command “install.packages()” by adding a “#” symbol before the command. This way the next time you run this file to create a Word document RStudio can skip re-installing of the packages. Note also that using the “#”&quot; symbol before any R command disables it so you could use this trick most generally.</p>
<p>We can load installed packages with the following command:</p>
<pre class="r"><code>library(lattice)</code></pre>
<p>Note:</p>
<ul>
<li>Watch the important way to separate plain vanilla text from R commands … <strong>all R commands must be inserted in a block</strong>.</li>
<li>lattice is one of the two major graphics packages in R. You can find plenty of examples with code on the web, and the author’s website is <a href="http://lmdvr.r-forge.r-project.org/figures/figures.html">here</a></li>
</ul>
</div>
<div id="reading-data-into-r" class="section level1">
<h1>Reading Data into R</h1>
<p>R is very flexible and can read data in Excel formats (.xls, .xlsx), text formats (.txt), CSV (comma separated variable) formats (.csv), etc.</p>
<p>Let us start with a simple data set – serotonin levels in the central nervous system of desert locusts that were experimentally crowded for 0 (the control group), 1, and 2 hours. Presumably locusts are shy and solitary as a rule but become gregarious and social in a drought or when they see/smell other locusts, and hence the locust swarms. See <a href="http://www.npr.org/templates/story/story.php?storyId=100020125">here</a> for an NPR story on this line of research.</p>
<pre class="r"><code>locusts = read.csv(&quot;http://whitlockschluter.zoology.ubc.ca/wp-content/data/chapter02/chap02f1_2locustSerotonin.csv&quot;)</code></pre>
<p>Now look at the upper-right window … you see the <strong>locusts</strong> data you just read-in. If you click the “play” button you’ll see the contents of the data-set. If you click the data-set you will open it up in the form of a spreadsheet. Do this now and notice you have the first column containing each locust’s serotonin level (titled “serotoninLevel” and measured in pmoles) and the treatment it was assigned to (titled “treatmentTime”).</p>
<ul>
<li>You can use the up/down buttons above each column to sort the data in an ascending/descending order, in case you want to eyeball your data. You can also use the “Filter” button to select subsets of your data. For example, if you only wanted to eyeball the treatmentTime = 2 group, you could do so by setting the filter in the treatmentTime column to 2.</li>
</ul>
<p>Quick Check:</p>
<ul>
<li>What kind of a variable is serotoninLevel?</li>
<li>What about treatmentTime?</li>
</ul>
<p>We can label the values of treatmentTime (see below):</p>
<pre class="r"><code>locusts$treatmentTime = factor(locusts$treatmentTime, levels = c(0, 1, 2), labels = c(&quot;Control&quot;, &quot;1 Hour&quot;, &quot;2 Hours&quot;))</code></pre>
<p>Watch how treatmentTime is now showing up as a “Factor” … R-speak for a categorical variable. R also tells you how many unique groups you have and the label each group carries.</p>
<p>Now that we have some data to work with, how should we describe it visually? Well, if we have a numeric variable then it is appropriate to use a Histogram to depict the variable’s distribution. Here we have three groups (treatmentTime = 0, =1, =2) so we will have to setup a Histogram for each group.</p>
<pre class="r"><code>histogram( ~ serotoninLevel | treatmentTime, data=locusts, layout=c(1,3))</code></pre>
<p><img src="/teaching/pbio/Lab01_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>Note the key commands here. The “~ serotoninLevel” piece tells R to use serotoninLevel as the variable of interest. “| treatmentTime” tells R to construct a histogram for each unique group is finds in a variable called treatmentTime. We also indicate the data we wish to use via “data = locusts”. The “layout=c(1,3)” tells R to squeeze the histograms into 1 column and 3 rows.</p>
<p>We could have also run the same plot as shown below; either way would be fine.</p>
<pre class="r"><code>histogram( ~ locusts$serotoninLevel | locusts$treatmentTime, layout=c(1,3))</code></pre>
<p><img src="/teaching/pbio/Lab01_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>We may not like the default number of bins. Instead, we may want to specify the width of each groups. How should we set the bin-width? One way to do this would be to see the minimum and maximum values. We do this (below) with the “summary()” command and find Min = 3.20 and Max = 21.30. The gap (Max - Min) is 21.30 - 3.20 = 18.10. If we want to break a distribution that has a range of 18.10 into 10 groups, that would mean each group would be about 18.10 divided by 10 = 1.81 pmoles wide. So let us set this as the bin-width.</p>
<pre class="r"><code>summary(locusts)</code></pre>
<pre><code>##  serotoninLevel   treatmentTime
##  Min.   : 3.200   Control:10   
##  1st Qu.: 4.675   1 Hour :10   
##  Median : 5.900   2 Hours:10   
##  Mean   : 8.407                
##  3rd Qu.:11.475                
##  Max.   :21.300</code></pre>
<pre class="r"><code>histogram(~ serotoninLevel | treatmentTime, data=locusts, breaks=seq(3.20, 21.30, by=1.81), layout=c(1,3))</code></pre>
<p><img src="/teaching/pbio/Lab01_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>We have some new commands here. The “breaks=seq(3.20, 21.30, by=1.81)” segment tells R to start making the groups from a minimum value of 3.20 to a maximum value of 21.30, and to make each group 1.81 units (here pmoles) wide.</p>
<p>What if we wanted only 5 groups? That would mean a bin-width of 18.10/5 = 3.62 pmoles. What would this distribution look like?</p>
<pre class="r"><code>histogram(~ serotoninLevel | treatmentTime, data=locusts, breaks=seq(3.20, 21.30, by=3.62), layout=c(1,3))</code></pre>
<p><img src="/teaching/pbio/Lab01_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>Hmm, too much compression of the data here. So we would have to figure out some happy medium between 5 and 10 groups but we’ll leave it for now.</p>
<div id="hemoglobin-concentration-example" class="section level2">
<h2>Hemoglobin Concentration Example</h2>
<pre class="r"><code>hemoglobinData = read.csv(&quot;http://whitlockschluter.zoology.ubc.ca/wp-content/data/chapter02/chap02e3cHumanHemoglobinElevation.csv&quot;)

histogram(~ hemoglobin | population, data=hemoglobinData)</code></pre>
<p><img src="/teaching/pbio/Lab01_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<pre class="r"><code>histogram(~ hemoglobin | population, data=hemoglobinData, breaks=seq(10, 26, by=1), layout=c(1,4))</code></pre>
<p><img src="/teaching/pbio/Lab01_files/figure-html/unnamed-chunk-9-2.png" width="672" /></p>
<pre class="r"><code>histogram(~ hemoglobin | population, data=hemoglobinData, breaks=seq(10, 26, by=1), layout=c(1,4), col=&quot;firebrick&quot;)</code></pre>
<p><img src="/teaching/pbio/Lab01_files/figure-html/unnamed-chunk-9-3.png" width="672" /></p>
<p>We have four groups; hence “layout=c(1,4)”. We also colored the bars with col=“xyz”. You can see the various color options available in R <a href="http://research.stowers-institute.org/efg/R/Color/Chart/ColorChart.pdf">here</a>.</p>
</div>
</div>
<div id="frequency-tables-and-bar-charts" class="section level1">
<h1>Frequency Tables and Bar-charts</h1>
<p>Bar-charts are appropriate for categorical (nominal/ordinal) variables. What if we wanted to calculate how many adults we have in each population group? Easy, let us first construct a frequency table.</p>
<pre class="r"><code>tab.1 = table(hemoglobinData$population)
tab.1</code></pre>
<pre><code>## 
##    Andes Ethiopia    Tibet      USA 
##       71      128       59     1704</code></pre>
<p>How about calculating relative Frequencies as proportions and percentages?</p>
<pre class="r"><code>tab.2 = prop.table(tab.1) # Flip tab.1 into a table of proportions
tab.2</code></pre>
<pre><code>## 
##      Andes   Ethiopia      Tibet        USA 
## 0.03618756 0.06523955 0.03007136 0.86850153</code></pre>
<pre class="r"><code>tab.3 = tab.2 * 100 # Take tab.2 and multiply each proportion by 100
tab.3</code></pre>
<pre><code>## 
##     Andes  Ethiopia     Tibet       USA 
##  3.618756  6.523955  3.007136 86.850153</code></pre>
<p>Now we can move on to creating a bar-chart from the frequency table.</p>
<pre class="r"><code>barplot(tab.1, ylim=c(0, 2000))</code></pre>
<p><img src="/teaching/pbio/Lab01_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<pre class="r"><code>barplot(tab.2, ylim=c(0, 1))</code></pre>
<p><img src="/teaching/pbio/Lab01_files/figure-html/unnamed-chunk-12-2.png" width="672" /></p>
<pre class="r"><code>barplot(tab.3, ylim=c(0, 100))</code></pre>
<p><img src="/teaching/pbio/Lab01_files/figure-html/unnamed-chunk-12-3.png" width="672" /></p>
<p>Note how simple it is to toss your frequency table into a bar-chart. What if we wanted to order the bars, maybe for tab.3 (which has the counts as percentages), and then plot these ordered values?</p>
<pre class="r"><code>tab.4 = sort(tab.3, decreasing=TRUE)

barplot(tab.4, ylim=c(0, 100), col=&quot;salmon&quot;) # coloring the bars</code></pre>
<p><img src="/teaching/pbio/Lab01_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<pre class="r"><code>barplot(tab.4, ylim=c(0, 100), col=c(&quot;salmon&quot;, &quot;cornflowerblue&quot;, &quot;navajowhite&quot;, &quot;gray&quot;), xlab=&quot;Population&quot;, ylab=&quot;Relative Frequency (%)&quot;) # setting unique bar colors and labeling the x-axis and y-axis</code></pre>
<p><img src="/teaching/pbio/Lab01_files/figure-html/unnamed-chunk-13-2.png" width="672" /></p>
<p>Note: “decreasing=TRUE” says sort the table in descending order of the counts.</p>
</div>
<div id="contingency-table-and-mosaic-plots" class="section level1">
<h1>Contingency Table and Mosaic Plots</h1>
<p>Here we need a data-set that has two categorical variables. Might as well stick with the reproduction and Malaria example since we know the context and have seen what we should expect.</p>
<p>Let us load the data first, then construct the contingency table and finally render the plot.</p>
<pre class="r"><code>malaria = read.csv(&quot;http://whitlockschluter.zoology.ubc.ca/wp-content/data/chapter02/chap02e3aBirdMalaria.csv&quot;)

tab.5 = table(malaria$response, malaria$treatment)
tab.5</code></pre>
<pre><code>##             
##              Control Egg removal
##   Malaria          7          15
##   No Malaria      28          15</code></pre>
<pre class="r"><code>tab.6 = prop.table(tab.5) # Proportions of full sample
tab.6</code></pre>
<pre><code>##             
##                Control Egg removal
##   Malaria    0.1076923   0.2307692
##   No Malaria 0.4307692   0.2307692</code></pre>
<pre class="r"><code>tab.6a = prop.table(tab.5, 1) # Row proportions
tab.6a</code></pre>
<pre><code>##             
##                Control Egg removal
##   Malaria    0.3181818   0.6818182
##   No Malaria 0.6511628   0.3488372</code></pre>
<pre class="r"><code>tab.6b = prop.table(tab.5, 2) # Column proportions
tab.6b</code></pre>
<pre><code>##             
##              Control Egg removal
##   Malaria        0.2         0.5
##   No Malaria     0.8         0.5</code></pre>
<pre class="r"><code>barplot(tab.5, beside=TRUE, ylim=c(0,30))</code></pre>
<p><img src="/teaching/pbio/Lab01_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<pre class="r"><code>mosaicplot(tab.5)</code></pre>
<p><img src="/teaching/pbio/Lab01_files/figure-html/unnamed-chunk-14-2.png" width="672" /></p>
<p>Notice that the preceding contingency tables lack totals. This can be fixed as shown below for tab.5 :</p>
<pre class="r"><code>Total = sum
tab.7a = addmargins(tab.5, margin = c(1,2), FUN = Total, quiet = TRUE)

tab.7a</code></pre>
<pre><code>##             
##              Control Egg removal Total
##   Malaria          7          15    22
##   No Malaria      28          15    43
##   Total           35          30    65</code></pre>
</div>
<div id="two-numeric-variables" class="section level1">
<h1>Two Numeric Variables?</h1>
<p>This would call for a scatter-plot, as in the case of the guppy data.</p>
<pre class="r"><code>guppies = read.csv(&quot;http://whitlockschluter.zoology.ubc.ca/wp-content/data/chapter02/chap02e3bGuppyFatherSonAttractiveness.csv&quot;)

plot(sonAttractiveness ~ fatherOrnamentation, data=guppies, col=&quot;purple&quot;, xlab=&quot;Father&#39;s Ornamentation&quot;, ylab=&quot;Son&#39;s Attractiveness&quot;, main=&quot;Scatterplot with the Guppy Data&quot;)</code></pre>
<p><img src="/teaching/pbio/Lab01_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>Note how we created the plot. The basic structure of the command is “plot(y ~ x, data)” and we asked for the son’s attractiveness to be plotted on the y-axis while the father’s ornamentation should go up on the x-axis, and that the data=gupipes. We also added some other elements … “xlab=” to give us a cleaner label for the x-axis and similarly one for the y-axis via “ylab=”. We also added a plot-title via “main=”. And of course changing the color of the points.</p>
</div>
<div id="line-charts" class="section level1">
<h1>Line Charts</h1>
<p>These would be ideal for time-series data, whether for a single group or multiple groups.</p>
<pre class="r"><code>measles = read.csv(&quot;http://whitlockschluter.zoology.ubc.ca/wp-content/data/chapter02/chap02e4aMeaslesOutbreaks.csv&quot;)

plot(confirmedCases ~ yearByQuarter, data=measles, type=&quot;l&quot;)</code></pre>
<p><img src="/teaching/pbio/Lab01_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<pre class="r"><code>plot(confirmedCases ~ yearByQuarter, data=measles, type=&quot;b&quot;, col=&quot;red&quot;, ylab=&quot;Confirmed Number of Cases&quot;, xlab=&quot;Year (by Quarter)&quot;)</code></pre>
<p><img src="/teaching/pbio/Lab01_files/figure-html/unnamed-chunk-17-2.png" width="672" /></p>
</div>
<div id="purely-for-demonstration-purposes" class="section level1">
<h1>Purely for demonstration purposes …</h1>
<p>Now a much more modern, interactive graph of the same data:</p>
<pre class="r"><code>library(plotly)
plot_ly(data = measles, x=yearByQuarter, y=confirmedCases)</code></pre>
<p>What if we had multiple time-series to plot? A good example would be stock prices (see below).</p>
<p>Source: <a href="http://blog.revolutionanalytics.com/2015/08/plotting-time-series-in-r.html">Joseph Rickert</a></p>
<pre class="r"><code>library(ggplot2)
library(xts)
library(dygraphs)
 
# Get IBM and Linkedin stock data from Yahoo Finance
ibm_url = &quot;http://real-chart.finance.yahoo.com/table.csv?s=IBM&amp;a=07&amp;b=24&amp;c=2010&amp;d=07&amp;e=24&amp;f=2015&amp;g=d&amp;ignore=.csv&quot;
lnkd_url = &quot;http://real-chart.finance.yahoo.com/table.csv?s=LNKD&amp;a=07&amp;b=24&amp;c=2010&amp;d=07&amp;e=24&amp;f=2015&amp;g=d&amp;ignore=.csv&quot;
 
yahoo.read = function(url){
   dat = read.table(url,header=TRUE,sep=&quot;,&quot;)
   df = dat[,c(1,5)]
   df$Date = as.Date(as.character(df$Date))
   return(df)}
 
ibm  = yahoo.read(ibm_url)
lnkd = yahoo.read(lnkd_url)

ggplot(ibm,aes(Date,Close)) + 
  geom_line(aes(color=&quot;ibm&quot;)) +
  geom_line(data=lnkd,aes(color=&quot;lnkd&quot;)) +
  labs(color=&quot;Legend&quot;) +
  scale_colour_manual(&quot;&quot;, breaks = c(&quot;ibm&quot;, &quot;lnkd&quot;),
                          values = c(&quot;blue&quot;, &quot;brown&quot;)) +
  ggtitle(&quot;Closing Stock Prices: IBM &amp; Linkedin&quot;) + 
  theme(plot.title = element_text(lineheight=.7, face=&quot;bold&quot;))

# dygraph() needs xts time series objects
ibm_xts = xts(ibm$Close,order.by=ibm$Date,frequency=365)
lnkd_xts = xts(lnkd$Close,order.by=lnkd$Date,frequency=365)
stocks = cbind(ibm_xts,lnkd_xts)
dygraph(stocks,ylab=&quot;Close&quot;, 
        main=&quot;IBM and Linkedin Closing Stock Prices&quot;) %&gt;%
  dySeries(&quot;..1&quot;,label=&quot;IBM&quot;) %&gt;%
  dySeries(&quot;..2&quot;,label=&quot;LNKD&quot;) %&gt;%
  dyOptions(colors = c(&quot;blue&quot;,&quot;brown&quot;)) %&gt;%
  dyRangeSelector()</code></pre>
</div>
